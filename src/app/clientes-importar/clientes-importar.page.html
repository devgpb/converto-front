<ion-content class="ion-padding">
  <ion-grid>
    <ion-row>
      <ion-col size="12" size-md="6">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Como importar</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item lines="none">
                <ion-icon slot="start" name="download-outline"></ion-icon>
                <ion-label>Prepare um arquivo CSV com os dados dos clientes.</ion-label>
              </ion-item>
              <ion-item lines="none">
                <ion-icon slot="start" name="cloud-upload-outline"></ion-icon>
                <ion-label>Arraste o arquivo para o campo ao lado ou clique para selecionar.</ion-label>
              </ion-item>
              <ion-item lines="none">
                <ion-icon slot="start" name="play-circle-outline"></ion-icon>
                <ion-label>Após adicionar o arquivo, clique em "Importar".</ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>

        <ion-card class="ion-margin-top">
          <ion-card-header>
            <ion-card-title>Exportar Clientes</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item lines="none">
                <ion-icon slot="start" name="document-outline"></ion-icon>
                <ion-label>
                  Gera um arquivo CSV com seus clientes. A exportação roda em segundo plano e o link ficará disponível em <strong>Meus Trabalhos</strong> quando concluir.
                </ion-label>
              </ion-item>
            </ion-list>
            <ion-button expand="block" color="secondary" (click)="exportar()">
              Exportar CSV
            </ion-button>
          </ion-card-content>
        </ion-card>
      </ion-col>
      <ion-col size="12" size-md="6">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Importar Clientes</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="dropzone" [class.dragover]="dragOver" (click)="openFileDialog(fileInput)" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">
              <ion-icon name="cloud-upload-outline" size="large"></ion-icon>
              <p>Arraste e solte o arquivo CSV aqui ou clique para selecionar</p>
              <input type="file" accept=".csv" (change)="onFileSelected($event)" #fileInput hidden />
            </div>
            <ion-list class="file-list" *ngIf="file">
              <ion-item lines="none">
                <ion-icon slot="start" name="document-text-outline"></ion-icon>
                <ion-label>{{ file.name }}</ion-label>
                <ion-button slot="end" fill="clear" color="danger" (click)="removeFile()">
                  <ion-icon slot="icon-only" name="close-circle"></ion-icon>
                </ion-button>
              </ion-item>
            </ion-list>
            <ion-item lines="none" class="ion-margin-top">
              <ion-label>Atribuir Clientes</ion-label>
              <ion-toggle [(ngModel)]="assignEnabled"></ion-toggle>
            </ion-item>
            <div *ngIf="assignEnabled" class="ion-margin-top">
              <ion-item>
                <ion-label position="stacked">Atribuir para</ion-label>
                <ion-select [(ngModel)]="selectedUserId" [disabled]="!isAdmin" interface="popover">
                  <ion-select-option [value]="currentUserId">Meus Clientes</ion-select-option>
                  <ion-select-option *ngFor="let u of usuarios"  [value]="getUserId(u)">
                    {{ u.name }}
                  </ion-select-option>
                </ion-select>
              </ion-item>
              <ion-note color="medium" *ngIf="!isAdmin">Somente administradores podem atribuir para outros usuários.</ion-note>
            </div>
            <ion-list class="csv-info">
              <ion-item lines="none">
                <ion-icon slot="start" name="list-outline"></ion-icon>
                <ion-label>Separador: ponto e vírgula (;)</ion-label>
              </ion-item>
              <ion-item lines="none">
                <ion-icon slot="start" name="alert-circle-outline"></ion-icon>
                <ion-label>Campos obrigatórios: nome, celular</ion-label>
              </ion-item>
              <ion-item lines="none">
                <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                <ion-label>Campos opcionais: status, cidade, indicacao, campanha, observacao. A atribuição é feita acima e não deve ir no CSV.</ion-label>
              </ion-item>
            </ion-list>
            <ion-button expand="block" fill="outline" class="ion-margin-top" (click)="baixarExemploCSV()">
              Baixar modelo CSV
            </ion-button>
            <ion-button expand="block" class="ion-margin-top" (click)="importar()" [disabled]="!file">Importar</ion-button>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
    
  </ion-grid>
</ion-content>

