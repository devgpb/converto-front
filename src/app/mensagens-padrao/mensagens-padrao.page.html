<ion-content class="ion-padding">
  <ion-card>
    <ion-card-header>
      <ion-card-title>Nova Mensagem Padrão</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <form [formGroup]="novoForm" (ngSubmit)="salvarNovo()" class="wa-form">
        <ion-item lines="none" class="wa-item">
          <ion-label position="stacked">Nome</ion-label>
          <ion-input formControlName="nome" placeholder="Nome da Mensagem"></ion-input>
        </ion-item>
        <ion-item lines="none" class="wa-item">
          <ion-label position="stacked">Mensagem</ion-label>
          <textarea formControlName="mensagem" class="wa-textarea" placeholder="Digite como no WhatsApp..."></textarea>
        </ion-item>
        <ion-button expand="block" type="submit" [disabled]="novoForm.invalid">
          Cadastrar
        </ion-button>
      </form>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Mensagens Salvas</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-searchbar debounce="300" [value]="busca" (ionInput)="onBuscar($event)" placeholder="Pesquisar por nome ou conteúdo"></ion-searchbar>
      <div *ngIf="mensagensFiltradas.length === 0" class="wa-empty">Nenhuma mensagem encontrada</div>
      <ng-container *ngFor="let msg of mensagensFiltradas">
        <ion-card class="wa-msg-card">
          <ion-card-header class="wa-card-header">
            <ion-card-title>{{ msg.nome }}</ion-card-title>
            <div class="wa-actions">
              <ion-button *ngIf="editandoId !== msg.idMensagem" fill="clear" color="medium" (click)="iniciarEdicao(msg)">
                <ion-icon slot="icon-only" name="create"></ion-icon>
              </ion-button>
              <ion-button *ngIf="editandoId !== msg.idMensagem" fill="clear" color="danger" (click)="remover(msg)">
                <ion-icon slot="icon-only" name="trash"></ion-icon>
              </ion-button>
            </div>
          </ion-card-header>
          <ion-card-content>
            <!-- Visualização -->
            <div *ngIf="editandoId !== msg.idMensagem" class="wa-bubble">
              {{ msg.mensagem }}
            </div>

            <!-- Edição inline no próprio card -->
            <form *ngIf="editandoId === msg.idMensagem && editForm" [formGroup]="editForm" class="wa-form">
              <ion-item lines="none" class="wa-item">
                <ion-label position="stacked">Nome</ion-label>
                <ion-input formControlName="nome"></ion-input>
              </ion-item>
              <ion-item lines="none" class="wa-item">
                <ion-label position="stacked">Mensagem</ion-label>
                <textarea formControlName="mensagem" class="wa-textarea" placeholder="Digite como no WhatsApp..."></textarea>
              </ion-item>
              <div class="wa-edit-actions">
                <ion-button color="primary" (click)="salvarEdicao(msg)" [disabled]="editForm.invalid">
                  Salvar
                </ion-button>
                <ion-button fill="clear" color="medium" (click)="cancelarEdicao()">
                  Cancelar
                </ion-button>
              </div>
            </form>
          </ion-card-content>
        </ion-card>
      </ng-container>
    </ion-card-content>
  </ion-card>
</ion-content>
